(()=>{"use strict";(()=>{let e=window.location.href,t=null,n=null,r=new Set,o=null,a=null,i=0,s=!1;window.parent&&window.parent!==window&&window.parent.postMessage({type:"IFRAME_READY",data:{url:window.location.href,timestamp:(new Date).toISOString()}},"*"),chrome.runtime.onMessage.addListener((e,t,n)=>{switch(e.type){case"AI_RESPONSE_RESULT":!function(e){try{const t=document.querySelector(".ai-review-button"),n=t?f(t):null;if(e&&e.success&&e.aiResponse&&"string"==typeof e.aiResponse){if(n){const t="TEXTAREA"===n.tagName||"INPUT"===n.tagName?n.value:n.textContent||"";(e.aiResponse.length>0||0===t.length)&&g(n,e.aiResponse)}!function(){const e=document.createElement("div");e.textContent="‚úÖ AI response generated successfully!",e.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: hsl(142, 76%, 36%);\n      color: white;\n      padding: 12px 16px;\n      border-radius: 6px;\n      font-size: 14px;\n      font-family: 'Inter', sans-serif;\n      z-index: 10000;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      max-width: 300px;\n      backdrop-filter: blur(12px);\n    ",document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.remove()},3e3)}()}else console.error("‚ùå AI response failed:",e?.error||"Unknown error"),n&&b(n),h(e?.error||"Failed to generate AI response")}catch(e){console.error("‚ùå Error handling AI response result:",e);try{const e=document.querySelector(".ai-review-button"),t=e?f(e):null;t&&b(t)}catch(e){console.error("‚ùå Error hiding loading state:",e)}h("An unexpected error occurred while processing the response")}}(e.data);break;case"PROGRESS_UPDATE":!function(e){try{const t=document.querySelector(".ai-review-button");if(t&&e){const n=function(e){switch(e){case"pending":return"Queued...";case"processing":return"Generating...";case"completed":return"Complete!";case"failed":return"Failed";default:return"Processing..."}}(e.status),r="number"==typeof e.progress?` (${e.progress}%)`:"";t.textContent=`ü§ñ ${n}${r}`}}catch(e){console.error("‚ùå Error updating progress:",e)}}(e.data)}n({success:!0})});const c=window.location.href,l=c.includes("/customers/reviews");function d(){const e=Date.now()-i;if(a&&(clearTimeout(a),a=null),e<1e3){const t=1e3-e;a=window.setTimeout(()=>{u(),a=null},t)}else u()}function u(){if(!s){s=!0,i=Date.now();try{p();const e=function(){const e=[];try{const t=document.querySelector('[jsname="YPqjbf"]');t&&("TEXTAREA"===t.tagName||t.hasAttribute("contenteditable"))&&function(e){if("TEXTAREA"!==e.tagName&&!e.hasAttribute("contenteditable"))return!1;if("YPqjbf"!==e.getAttribute("jsname"))return!1;const t=e.placeholder||e.getAttribute("data-placeholder")||"",n=["reply","respond","comment","response"].some(e=>t.toLowerCase().includes(e)),r=null!==e.closest("form");return n||r||"YPqjbf"===e.getAttribute("jsname")}(t)&&!function(e){const t=e.getAttribute("jsname");if(e.id,t){const e=document.querySelectorAll(".ai-review-button");for(const n of e)if(n.getAttribute("data-associated-jsname")===t)return!0}const n=e.closest("form, .modal, .dialog, .review-reply-container")||e.parentElement;return!(!n||!n.querySelector(".ai-review-button"))}(t)&&e.push(t)}catch(e){}return e}();if(e.length>0){let t=0,n=0;e.forEach((e,o)=>{if(m(e))n++;else{const n=function(e,t){if(m(e))return!1;try{const t=function(e){const t=document.createElement("button");return t.textContent="ü§ñ Generate AI Reply",t.className="ai-review-button VfPpkd-LgbsSe VfPpkd-LgbsSe-OWXEXe-k8QpJ VfPpkd-LgbsSe-OWXEXe-dgl2Hf nCP5yc AjY5Oe DuMIQc LQeN7 FwaX8",t.setAttribute("data-textarea-id",e.id||"textarea-"+Date.now()),t.style.cssText="\n      margin: 0 8px 0 0;\n      padding: 8px 16px;\n      background: hsl(217, 91%, 60%);\n      color: white;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 14px;\n      font-family: 'Inter', 'Google Sans', Roboto, Arial, sans-serif;\n      font-weight: 500;\n      transition: background-color 0.2s;\n      box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n      backdrop-filter: blur(12px);\n    ",t.onmouseover=()=>t.style.backgroundColor="hsl(217, 91%, 50%)",t.onmouseout=()=>t.style.backgroundColor="hsl(217, 91%, 60%)",t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),function(e){try{const t=function(){try{const e=document.querySelector("#AH1dze > div > div > main > div > div > c-wiz > div > div > article > div.noyJyc > div > div > div.N0c6q.JhRJje"),t=e?.textContent?.trim()||void 0;let n;const r=document.querySelector("span.DYizzd[aria-label]");if(r){const e=(r.getAttribute("aria-label")||"").match(/(\d+)\s*(?:de|out of)\s*5\s*(?:estrellas?|stars?)/i);e&&(n=parseInt(e[1],10))}if(!n&&r){const e=r.querySelectorAll("i.VfPpkd-kBDsod.lMAmUc:not(.VOmEhb)");e.length>0&&(n=e.length)}if(!n){const e=document.querySelector('span[aria-label*="de 5 estrellas"], span[aria-label*="out of 5 stars"]');if(e){const t=(e.getAttribute("aria-label")||"").match(/(\d+)\s*(?:de|out of)\s*5/);t&&(n=parseInt(t[1],10))}}if(!n){const e=document.querySelectorAll("span[aria-label]");for(const t of e){const e=(t.getAttribute("aria-label")||"").match(/(\d+)\s*(?:de|out of|\/)\s*5\s*(?:estrellas?|stars?)?/i);if(e){n=parseInt(e[1],10);break}}}if(!n){const e=document.querySelectorAll('i[aria-hidden="true"]:not(.VOmEhb)');e.length>0&&e.length<=5&&(n=e.length)}const o=document.querySelector("div.gyKkFe.JhRJje.Fv38Af"),a=o?.textContent?.trim();let i;if(i=a&&0!==a.length?a:"[Review with no text content]",!n){const e=i&&"[Review with no text content]"!==i&&(i.toLowerCase().includes("great")||i.toLowerCase().includes("excellent")||i.toLowerCase().includes("amazing")||i.toLowerCase().includes("love")||i.toLowerCase().includes("fantastic")),t=i&&"[Review with no text content]"!==i&&(i.toLowerCase().includes("bad")||i.toLowerCase().includes("terrible")||i.toLowerCase().includes("worst")||i.toLowerCase().includes("disappointed")||i.toLowerCase().includes("awful"));n=e&&!t?5:t?1:3}return t||n||"[Review with no text content]"!==i?{reviewer_name:t,review_rating:n,review_text:i,website_url:window.location.href,source_platform:"Google"}:null}catch(e){return console.error("‚ùå Error extracting review data:",e),null}}();if(!t)return console.error("‚ùå Could not extract review data"),void h("Could not extract review data. Please try again.");!function(e){const t=document.querySelector(".ai-review-button");if(t&&(t.textContent="ü§ñ Generating...",t.style.opacity="0.6",t.style.pointerEvents="none"),e.hasAttribute("placeholder")){const t=e.getAttribute("placeholder")||"";e.setAttribute("data-original-placeholder",t),e.setAttribute("placeholder","Generating AI response...")}}(e),chrome.runtime.sendMessage({type:"GENERATE_AI_RESPONSE",data:{reviewData:t}},n=>{if(n&&n.success){const r=n.aiResponse||"",o="TEXTAREA"===e.tagName||"INPUT"===e.tagName?e.value:e.textContent||"";(r.length>0||0===o.length)&&g(e,r),window.parent&&window.parent!==window&&window.parent.postMessage({type:"REPLY_GENERATED",data:{replyLength:r.length,reviewTextLength:t.review_text?t.review_text.length:0,confidence:n.confidence,processingTime:n.processingTime,tokensUsed:n.tokensUsed,timestamp:(new Date).toISOString()}},"*")}else console.error("‚ùå Error generating AI response:",n?.error),h(n?.error||"Failed to generate AI response"),b(e)})}catch(t){console.error("‚ùå Error in generateAIReply:",t),h("An unexpected error occurred. Please try again."),b(e)}}(e)}),t.innerHTML='\n      <div class="VfPpkd-Jh9lGc"></div>\n      <div class="VfPpkd-J1Ukfc-LhBDec"></div>\n      <div class="VfPpkd-RLmnJb"></div>\n      <span jsname="V67aGc" class="VfPpkd-vQzf8d">ü§ñ Generate AI Reply</span>\n    ',t}(e),n=function(e){const t=document.querySelector("div.FkJOzc.lgfhc.LW6Hp");if(t){const e=t.querySelector('button[jsname="dmDvRc"]');if(e)return{container:t,reference:e};const n=t.querySelector("button");if(n)return{container:t,reference:n}}const n=e.closest("form");if(n){const e=n.querySelector(".button-container, .form-actions, .actions");if(e)return{container:e,reference:e.firstElementChild}}return e.parentElement?{container:e.parentElement,reference:e.nextElementSibling}:null}(e);return!!n&&(function(e,t,n){t.reference?t.container.insertBefore(e,t.reference):t.container.appendChild(e);const r=n.getAttribute("jsname")||n.id||"anonymous-textarea";e.setAttribute("data-associated-textarea",r),e.setAttribute("data-associated-jsname",n.getAttribute("jsname")||""),e.setAttribute("data-injection-timestamp",Date.now().toString())}(t,n,e),r.add(t),!0)}catch(e){return console.error(`‚ùå Failed to inject button for textarea ${t+1}:`,e),!1}}(e,o);n&&t++}})}}finally{s=!1}}}function p(){document.querySelectorAll(".ai-review-button").forEach(e=>{const t=e.getAttribute("data-associated-jsname"),n=e.getAttribute("data-injection-timestamp");let o=!1;if(t){const e=document.querySelector(`[jsname="${t}"]`);o=null!==e&&document.contains(e)}o?n&&Date.now()-parseInt(n)>6e5&&(e.remove(),r.delete(e)):(e.parentNode&&e.remove(),r.delete(e))})}function f(e){const t=document.querySelector('textarea[jsname="YPqjbf"]')||document.querySelector('[jsname="YPqjbf"]');if(t)return t;const n=e.parentElement;if(n){const e=n.querySelector("textarea")||n.querySelector('[contenteditable="true"]');if(e)return e}const r=e.parentElement?.previousElementSibling?.querySelector("textarea")||e.parentElement?.previousElementSibling?.querySelector('[contenteditable="true"]');if(r)return r;return document.querySelector("textarea")||null}function m(e){const t=e.id||e.getAttribute("jsname")||"anonymous-textarea",n=document.querySelectorAll(".ai-review-button");for(const e of n)if(e.getAttribute("data-associated-textarea")===t&&r.has(e))return e;const o=[".review-reply-container",".reply-form","form",".modal",".dialog",".review-item",".comment-form"];for(const t of o){const n=e.closest(t);if(n){const e=n.querySelector(".ai-review-button");if(e&&r.has(e))return e}}let a=e;for(let e=0;e<3&&a;e++){const e=a.querySelector(".ai-review-button");if(e&&r.has(e))return e;a=a.parentElement}return null}function b(e){const t=document.querySelector(".ai-review-button");if(t&&(t.textContent="ü§ñ Generate AI Reply",t.style.opacity="1",t.style.pointerEvents="auto"),e.hasAttribute("data-original-placeholder")){const t=e.getAttribute("data-original-placeholder")||"";e.setAttribute("placeholder",t),e.removeAttribute("data-original-placeholder")}}function g(e,t){b(e),"TEXTAREA"===e.tagName||"INPUT"===e.tagName?(e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0}))):e.hasAttribute("contenteditable")&&(e.textContent=t,e.dispatchEvent(new Event("input",{bubbles:!0}))),e.focus()}function h(e){const t=document.createElement("div");t.textContent=`‚ùå ${e}`,t.style.cssText="\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: hsl(0, 84%, 60%);\n      color: white;\n      padding: 12px 16px;\n      border-radius: 6px;\n      font-size: 14px;\n      font-family: 'Inter', sans-serif;\n      z-index: 10000;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      max-width: 300px;\n      backdrop-filter: blur(12px);\n    ",document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},5e3)}function w(){n&&(clearInterval(n),n=null),a&&(clearTimeout(a),a=null),t&&(t.disconnect(),t=null),o&&(o.disconnect(),o=null),r.clear()}c.includes("/customers/reviews/reply"),l&&(n=window.setInterval(()=>{const t=window.location.href;t!==e&&(e=t,p())},500),t=new MutationObserver(e=>{let t=!1,n=[];e.forEach(e=>{"childList"===e.type?(e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const r=e;(r.matches('[jsname="YPqjbf"]')||r.querySelector('[jsname="YPqjbf"]'))&&(t=!0,n.push("textarea_added"))}}),e.removedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const r=e;(r.matches('[jsname="YPqjbf"]')||r.querySelector('[jsname="YPqjbf"]'))&&(t=!0,n.push("textarea_removed"))}}),!t&&(e.addedNodes.length>0||e.removedNodes.length>0)&&Array.from(e.addedNodes).some(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;return t.matches("form, .modal, .dialog, .review-reply-container, .reply-form")||t.querySelector("form, .modal, .dialog, .review-reply-container, .reply-form")}return!1})&&(t=!0,n.push("structural_change"))):"attributes"===e.type&&e.target.nodeType===Node.ELEMENT_NODE&&e.target.matches('[jsname="YPqjbf"]')&&["id","class","placeholder","jsname"].includes(e.attributeName||"")&&(t=!0,n.push("textarea_attribute_changed"))}),t&&d()}),t.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id","class","placeholder","jsname"]}),d(),o=new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.removedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;t.classList.contains("ai-review-button")&&r.delete(t),t.querySelectorAll(".ai-review-button").forEach(e=>{r.delete(e)})}})})}),o.observe(document.body,{childList:!0,subtree:!0})),window.addEventListener("beforeunload",w),window.addEventListener("pagehide",w),setInterval(()=>{},3e4)})()})();
//# sourceMappingURL=iframe-script.js.map