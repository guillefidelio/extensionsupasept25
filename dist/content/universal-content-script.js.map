{"version":3,"file":"content/universal-content-script.js","mappings":"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","sources":["webpack://chrome-extension-ai-review-replier/./src/content/universal-content-script.ts"],"sourcesContent":["// Bolt Reply AI — Universal Content Script\r\n// Runs on all non-Google pages.\r\n// Uses the same GENERATE_AI_RESPONSE / AI_RESPONSE_RESULT message contract as iframe-script.ts.\r\n// No project imports — fully self-contained so webpack produces a single flat file.\r\n\r\n(() => {\r\n  // ── Constants ──────────────────────────────────────────────────────────────\r\n  const BRAND_BLUE = 'hsl(217, 91%, 60%)';\r\n  const BRAND_BLUE_DARK = 'hsl(217, 91%, 50%)';\r\n  const HOST_ID = 'boltreply-universal-host';\r\n  const BTN_ID = 'boltreply-float-btn';\r\n\r\n  const LIGHTNING_SVG = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"white\"><path d=\"M13 2L3 14h9l-1 8 10-12h-9l1-8z\"/></svg>`;\r\n  const ICON_URL = chrome.runtime.getURL('icons/icon48.png');\r\n  const LOGO_URL = chrome.runtime.getURL('icons/boltreplyainameicon.png');\r\n\r\n  // ── State ──────────────────────────────────────────────────────────────────\r\n  let savedSelectionText = '';\r\n  let isLoading = false;\r\n  let panelOpen = false;\r\n\r\n  // Panel field values preserved across open/close cycles\r\n  let fieldReviewerName = '';\r\n  let fieldStarRating = 0;\r\n  let fieldReviewText = '';\r\n  let lastGeneratedReply = '';\r\n\r\n  // ── Floating button ────────────────────────────────────────────────────────\r\n\r\n  function getOrCreateFloatingButton(): HTMLElement {\r\n    const existing = document.getElementById(BTN_ID);\r\n    if (existing) return existing;\r\n\r\n    const btn = document.createElement('div');\r\n    btn.id = BTN_ID;\r\n    btn.title = 'Generate reply with Bolt Reply AI';\r\n    btn.innerHTML = `<img src=\"${ICON_URL}\" style=\"width:40px;height:40px;border-radius:50%;display:block;pointer-events:none;\" alt=\"Bolt Reply AI\" />`;\r\n    btn.style.cssText = `\r\n      position: fixed;\r\n      z-index: 2147483647;\r\n      display: none;\r\n      width: 40px;\r\n      height: 40px;\r\n      border-radius: 50%;\r\n      background: transparent;\r\n      box-shadow: 0 2px 12px rgba(0,0,0,0.25);\r\n      cursor: pointer;\r\n      transition: transform 0.1s, box-shadow 0.15s;\r\n      user-select: none;\r\n    `;\r\n\r\n    btn.addEventListener('mouseenter', () => {\r\n      btn.style.transform = 'scale(1.1)';\r\n      btn.style.boxShadow = '0 4px 16px rgba(0,0,0,0.35)';\r\n    });\r\n    btn.addEventListener('mouseleave', () => {\r\n      btn.style.transform = 'scale(1)';\r\n      btn.style.boxShadow = '0 2px 12px rgba(0,0,0,0.25)';\r\n    });\r\n\r\n    btn.addEventListener('mousedown', (e) => {\r\n      // Prevent the click from clearing the selection before we read it\r\n      e.preventDefault();\r\n    });\r\n\r\n    btn.addEventListener('click', () => {\r\n      const textToUse = savedSelectionText;\r\n      hideFloatingButton();\r\n      openPanel(textToUse);\r\n    });\r\n\r\n    document.body.appendChild(btn);\r\n    return btn;\r\n  }\r\n\r\n  function showFloatingButton(rect: DOMRect): void {\r\n    const btn = getOrCreateFloatingButton();\r\n    const btnSize = 40;\r\n    const margin = 8;\r\n\r\n    // getBoundingClientRect() is already viewport-relative; position:fixed uses viewport coords\r\n    let top = rect.top - btnSize - margin;\r\n    let left = rect.right - btnSize;\r\n\r\n    // If button would go above viewport top, show it below the selection instead\r\n    if (top < margin) {\r\n      top = rect.bottom + margin;\r\n    }\r\n    // Clamp horizontally so it stays within the visible viewport\r\n    left = Math.max(margin, Math.min(left, window.innerWidth - btnSize - margin));\r\n\r\n    btn.style.top = `${top}px`;\r\n    btn.style.left = `${left}px`;\r\n    btn.style.display = 'flex';\r\n  }\r\n\r\n  function hideFloatingButton(): void {\r\n    const btn = document.getElementById(BTN_ID);\r\n    if (btn) btn.style.display = 'none';\r\n  }\r\n\r\n  // ── Side panel (Shadow DOM) ────────────────────────────────────────────────\r\n\r\n  function getOrCreatePanelHost(): ShadowRoot {\r\n    let host = document.getElementById(HOST_ID);\r\n    if (host && host.shadowRoot) return host.shadowRoot;\r\n\r\n    host = document.createElement('div');\r\n    host.id = HOST_ID;\r\n    host.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      right: 0;\r\n      width: 0;\r\n      height: 0;\r\n      z-index: 2147483646;\r\n      pointer-events: none;\r\n    `;\r\n    document.body.appendChild(host);\r\n    return host.attachShadow({ mode: 'open' });\r\n  }\r\n\r\n  function getPanelCSS(): string {\r\n    return `\r\n      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }\r\n\r\n      :host { all: initial; }\r\n\r\n      .panel {\r\n        position: fixed;\r\n        top: 0;\r\n        right: 0;\r\n        width: 360px;\r\n        height: 100vh;\r\n        background: #ffffff;\r\n        border-left: 1px solid #e2e8f0;\r\n        box-shadow: -4px 0 24px rgba(0,0,0,0.12);\r\n        display: flex;\r\n        flex-direction: column;\r\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\r\n        font-size: 14px;\r\n        color: #1a202c;\r\n        transform: translateX(100%);\r\n        transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);\r\n        pointer-events: all;\r\n        overflow: hidden;\r\n      }\r\n      .panel.open { transform: translateX(0); }\r\n\r\n      /* Header */\r\n      .header {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-between;\r\n        padding: 14px 16px;\r\n        border-bottom: 1px solid #e2e8f0;\r\n        background: #f8fafc;\r\n        flex-shrink: 0;\r\n      }\r\n      .header-logo {\r\n        display: flex;\r\n        align-items: center;\r\n      }\r\n      .header-logo img {\r\n        height: 28px;\r\n        width: auto;\r\n        object-fit: contain;\r\n        display: block;\r\n      }\r\n      .close-btn {\r\n        background: none;\r\n        border: none;\r\n        cursor: pointer;\r\n        color: #64748b;\r\n        padding: 4px;\r\n        border-radius: 4px;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        transition: background 0.15s, color 0.15s;\r\n        line-height: 1;\r\n      }\r\n      .close-btn:hover { background: #f1f5f9; color: #1a202c; }\r\n\r\n      /* Body */\r\n      .body {\r\n        flex: 1;\r\n        overflow-y: auto;\r\n        padding: 16px;\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 14px;\r\n      }\r\n\r\n      /* Credits badge */\r\n      .credits-badge {\r\n        display: inline-flex;\r\n        align-items: center;\r\n        gap: 5px;\r\n        font-size: 12px;\r\n        color: #64748b;\r\n        background: #f1f5f9;\r\n        border: 1px solid #e2e8f0;\r\n        border-radius: 20px;\r\n        padding: 3px 10px;\r\n        font-weight: 500;\r\n        align-self: flex-end;\r\n      }\r\n      .credits-badge .dot {\r\n        width: 6px;\r\n        height: 6px;\r\n        border-radius: 50%;\r\n        background: hsl(217, 91%, 60%);\r\n        flex-shrink: 0;\r\n      }\r\n\r\n      /* Form sections */\r\n      .field { display: flex; flex-direction: column; gap: 5px; }\r\n      .label {\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n        color: #374151;\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.04em;\r\n      }\r\n      input[type=\"text\"], textarea {\r\n        width: 100%;\r\n        border: 1px solid #d1d5db;\r\n        border-radius: 6px;\r\n        padding: 8px 10px;\r\n        font-size: 13px;\r\n        font-family: inherit;\r\n        color: #1a202c;\r\n        background: #fff;\r\n        resize: vertical;\r\n        transition: border-color 0.15s, box-shadow 0.15s;\r\n        outline: none;\r\n      }\r\n      input[type=\"text\"]:focus, textarea:focus {\r\n        border-color: hsl(217, 91%, 60%);\r\n        box-shadow: 0 0 0 3px hsla(217, 91%, 60%, 0.15);\r\n      }\r\n      textarea { min-height: 135px; }\r\n\r\n      .result-area {\r\n        width: 100%;\r\n        border: 1px solid #d1d5db;\r\n        border-radius: 6px;\r\n        padding: 8px 10px;\r\n        font-size: 13px;\r\n        font-family: inherit;\r\n        color: #1a202c;\r\n        background: #f8fafc;\r\n        white-space: pre-wrap;\r\n        word-break: break-word;\r\n        line-height: 1.55;\r\n        user-select: none;\r\n        cursor: default;\r\n      }\r\n\r\n      /* Stars */\r\n      .stars { display: flex; gap: 4px; }\r\n      .star {\r\n        font-size: 22px;\r\n        cursor: pointer;\r\n        color: #d1d5db;\r\n        line-height: 1;\r\n        transition: color 0.1s, transform 0.1s;\r\n        user-select: none;\r\n      }\r\n      .star.filled { color: #f59e0b; }\r\n      .star:hover { transform: scale(1.15); }\r\n\r\n      /* Buttons */\r\n      .btn {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        gap: 7px;\r\n        padding: 9px 16px;\r\n        border: none;\r\n        border-radius: 7px;\r\n        font-size: 13px;\r\n        font-weight: 600;\r\n        font-family: inherit;\r\n        cursor: pointer;\r\n        transition: background 0.15s, opacity 0.15s, transform 0.1s;\r\n        outline: none;\r\n        width: 100%;\r\n      }\r\n      .btn:active { transform: scale(0.98); }\r\n      .btn-primary {\r\n        background: hsl(217, 91%, 60%);\r\n        color: #fff;\r\n      }\r\n      .btn-primary:hover:not(:disabled) { background: hsl(217, 91%, 50%); }\r\n      .btn-primary:disabled {\r\n        opacity: 0.6;\r\n        cursor: not-allowed;\r\n      }\r\n      .btn-secondary {\r\n        background: #f1f5f9;\r\n        color: #374151;\r\n        border: 1px solid #e2e8f0;\r\n      }\r\n      .btn-secondary:hover { background: #e2e8f0; }\r\n\r\n      /* Result section */\r\n      .result-section {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 8px;\r\n        padding-top: 4px;\r\n        border-top: 1px solid #e2e8f0;\r\n      }\r\n      .result-label {\r\n        font-size: 12px;\r\n        font-weight: 600;\r\n        color: #374151;\r\n        text-transform: uppercase;\r\n        letter-spacing: 0.04em;\r\n      }\r\n\r\n      /* Error / info message */\r\n      .message-box {\r\n        padding: 10px 12px;\r\n        border-radius: 6px;\r\n        font-size: 12px;\r\n        font-weight: 500;\r\n        line-height: 1.5;\r\n      }\r\n      .message-box.error { background: #fef2f2; color: #b91c1c; border: 1px solid #fecaca; }\r\n      .message-box.info  { background: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }\r\n\r\n      /* Spinner */\r\n      @keyframes spin { to { transform: rotate(360deg); } }\r\n      .spinner {\r\n        width: 14px;\r\n        height: 14px;\r\n        border: 2px solid rgba(255,255,255,0.4);\r\n        border-top-color: #fff;\r\n        border-radius: 50%;\r\n        animation: spin 0.7s linear infinite;\r\n        flex-shrink: 0;\r\n      }\r\n\r\n      /* Divider */\r\n      .divider { height: 1px; background: #e2e8f0; margin: 2px 0; }\r\n    `;\r\n  }\r\n\r\n  function buildPanelHTML(shadowRoot: ShadowRoot): void {\r\n    shadowRoot.innerHTML = '';\r\n\r\n    const style = document.createElement('style');\r\n    style.textContent = getPanelCSS();\r\n    shadowRoot.appendChild(style);\r\n\r\n    const panel = document.createElement('div');\r\n    panel.className = 'panel';\r\n    panel.id = 'boltreply-panel';\r\n\r\n    panel.innerHTML = `\r\n      <div class=\"header\">\r\n        <div class=\"header-logo\">\r\n          <img src=\"${LOGO_URL}\" alt=\"Bolt Reply AI\" />\r\n        </div>\r\n        <button class=\"close-btn\" id=\"br-close\" title=\"Close panel\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n            <line x1=\"18\" y1=\"6\" x2=\"6\" y2=\"18\"/><line x1=\"6\" y1=\"6\" x2=\"18\" y2=\"18\"/>\r\n          </svg>\r\n        </button>\r\n      </div>\r\n\r\n      <div class=\"body\">\r\n\r\n        <div class=\"credits-badge\">\r\n          <span class=\"dot\"></span>\r\n          <span id=\"br-credits\">Loading credits...</span>\r\n        </div>\r\n\r\n        <div class=\"field\">\r\n          <span class=\"label\">Reviewer Name</span>\r\n          <input type=\"text\" id=\"br-name\" placeholder=\"Customer name (optional)\" />\r\n        </div>\r\n\r\n        <div class=\"field\">\r\n          <span class=\"label\">Star Rating</span>\r\n          <div class=\"stars\" id=\"br-stars\">\r\n            <span class=\"star\" data-value=\"1\">&#9733;</span>\r\n            <span class=\"star\" data-value=\"2\">&#9733;</span>\r\n            <span class=\"star\" data-value=\"3\">&#9733;</span>\r\n            <span class=\"star\" data-value=\"4\">&#9733;</span>\r\n            <span class=\"star\" data-value=\"5\">&#9733;</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"field\">\r\n          <span class=\"label\">Review Text</span>\r\n          <textarea id=\"br-review\" placeholder=\"Paste or type the customer review here...\"></textarea>\r\n        </div>\r\n\r\n        <div id=\"br-error-box\" style=\"display:none;\"></div>\r\n\r\n        <button class=\"btn btn-primary\" id=\"br-generate\">\r\n          ${LIGHTNING_SVG}\r\n          <span id=\"br-btn-label\">Generate Reply</span>\r\n        </button>\r\n\r\n        <div class=\"divider\"></div>\r\n\r\n        <div class=\"result-section\" id=\"br-result-section\" style=\"display:none;\">\r\n          <span class=\"result-label\">Generated Reply</span>\r\n          <div class=\"result-area\" id=\"br-result\"></div>\r\n          <button class=\"btn btn-secondary\" id=\"br-copy\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n              <rect x=\"9\" y=\"9\" width=\"13\" height=\"13\" rx=\"2\" ry=\"2\"/><path d=\"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1\"/>\r\n            </svg>\r\n            Copy to Clipboard\r\n          </button>\r\n        </div>\r\n\r\n      </div>\r\n    `;\r\n\r\n    shadowRoot.appendChild(panel);\r\n    attachPanelListeners(shadowRoot);\r\n  }\r\n\r\n  function attachPanelListeners(shadowRoot: ShadowRoot): void {\r\n    // Close button\r\n    shadowRoot.getElementById('br-close')?.addEventListener('click', closePanel);\r\n\r\n    // Star rating\r\n    const starsContainer = shadowRoot.getElementById('br-stars');\r\n    starsContainer?.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      const value = parseInt(target.getAttribute('data-value') || '0', 10);\r\n      if (value) setStarRating(shadowRoot, value);\r\n    });\r\n    starsContainer?.addEventListener('mouseover', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      const value = parseInt(target.getAttribute('data-value') || '0', 10);\r\n      if (value) highlightStars(shadowRoot, value);\r\n    });\r\n    starsContainer?.addEventListener('mouseleave', () => {\r\n      highlightStars(shadowRoot, fieldStarRating);\r\n    });\r\n\r\n    // Name field persistence\r\n    const nameInput = shadowRoot.getElementById('br-name') as HTMLInputElement | null;\r\n    nameInput?.addEventListener('input', () => {\r\n      fieldReviewerName = nameInput.value;\r\n    });\r\n\r\n    // Review text persistence\r\n    const reviewTextarea = shadowRoot.getElementById('br-review') as HTMLTextAreaElement | null;\r\n    reviewTextarea?.addEventListener('input', () => {\r\n      fieldReviewText = reviewTextarea.value;\r\n    });\r\n\r\n    // Generate button\r\n    shadowRoot.getElementById('br-generate')?.addEventListener('click', () => {\r\n      handleGenerate(shadowRoot);\r\n    });\r\n\r\n    // Copy button\r\n    shadowRoot.getElementById('br-copy')?.addEventListener('click', () => {\r\n      handleCopy(shadowRoot);\r\n    });\r\n  }\r\n\r\n  function setStarRating(shadowRoot: ShadowRoot, value: number): void {\r\n    fieldStarRating = value;\r\n    highlightStars(shadowRoot, value);\r\n  }\r\n\r\n  function highlightStars(shadowRoot: ShadowRoot, upTo: number): void {\r\n    const stars = shadowRoot.querySelectorAll('.star');\r\n    stars.forEach((star, i) => {\r\n      if (i < upTo) {\r\n        star.classList.add('filled');\r\n      } else {\r\n        star.classList.remove('filled');\r\n      }\r\n    });\r\n  }\r\n\r\n  // ── Panel open / close ─────────────────────────────────────────────────────\r\n\r\n  function openPanel(prefillText: string): void {\r\n    const shadowRoot = getOrCreatePanelHost();\r\n    buildPanelHTML(shadowRoot);\r\n\r\n    // Restore / set field values\r\n    fieldReviewText = prefillText || fieldReviewText;\r\n    const nameInput = shadowRoot.getElementById('br-name') as HTMLInputElement | null;\r\n    const reviewTextarea = shadowRoot.getElementById('br-review') as HTMLTextAreaElement | null;\r\n    if (nameInput) nameInput.value = fieldReviewerName;\r\n    if (reviewTextarea) reviewTextarea.value = fieldReviewText;\r\n    highlightStars(shadowRoot, fieldStarRating);\r\n\r\n    // Restore previous result if any\r\n    if (lastGeneratedReply) {\r\n      showResult(shadowRoot, lastGeneratedReply);\r\n    }\r\n\r\n    loadCredits(shadowRoot);\r\n\r\n    // Trigger slide-in on next frame\r\n    requestAnimationFrame(() => {\r\n      const panel = shadowRoot.getElementById('boltreply-panel');\r\n      if (panel) panel.classList.add('open');\r\n      panelOpen = true;\r\n    });\r\n  }\r\n\r\n  function closePanel(): void {\r\n    const host = document.getElementById(HOST_ID);\r\n    if (!host?.shadowRoot) return;\r\n    const panel = host.shadowRoot.getElementById('boltreply-panel');\r\n    if (panel) {\r\n      panel.classList.remove('open');\r\n      setTimeout(() => { panelOpen = false; }, 250);\r\n    }\r\n  }\r\n\r\n  // ── Credits ────────────────────────────────────────────────────────────────\r\n\r\n  function loadCredits(shadowRoot: ShadowRoot): void {\r\n    const creditsEl = shadowRoot.getElementById('br-credits');\r\n    if (!creditsEl) return;\r\n\r\n    chrome.storage.local.get(['credits_remaining'], (result) => {\r\n      if (chrome.runtime.lastError) return;\r\n      const val = result['credits_remaining'];\r\n      if (typeof val === 'number') {\r\n        creditsEl.textContent = `${val} credits remaining`;\r\n      } else {\r\n        creditsEl.textContent = 'Credits unavailable';\r\n      }\r\n    });\r\n  }\r\n\r\n  function updateCredits(shadowRoot: ShadowRoot, remaining: number): void {\r\n    const creditsEl = shadowRoot.getElementById('br-credits');\r\n    if (creditsEl) creditsEl.textContent = `${remaining} credits remaining`;\r\n    chrome.storage.local.set({ credits_remaining: remaining });\r\n  }\r\n\r\n  // ── Generation ─────────────────────────────────────────────────────────────\r\n\r\n  function handleGenerate(shadowRoot: ShadowRoot): void {\r\n    if (isLoading) return;\r\n\r\n    const nameInput = shadowRoot.getElementById('br-name') as HTMLInputElement | null;\r\n    const reviewTextarea = shadowRoot.getElementById('br-review') as HTMLTextAreaElement | null;\r\n\r\n    const reviewerName = nameInput?.value.trim() || undefined;\r\n    const reviewText = reviewTextarea?.value.trim() || '';\r\n\r\n    clearError(shadowRoot);\r\n\r\n    if (!reviewText) {\r\n      showError(shadowRoot, 'Please enter the review text before generating a reply.');\r\n      return;\r\n    }\r\n\r\n    // Auth check first\r\n    chrome.runtime.sendMessage({ type: 'GET_AUTH_STATUS' }, (authResponse: { isAuthenticated?: boolean } | undefined) => {\r\n      if (chrome.runtime.lastError || !authResponse?.isAuthenticated) {\r\n        showError(shadowRoot, 'Please log in via the Bolt Reply extension icon first.');\r\n        return;\r\n      }\r\n\r\n      setLoadingState(shadowRoot, true);\r\n\r\n      const reviewData = {\r\n        review_text: reviewText,\r\n        reviewer_name: reviewerName,\r\n        review_rating: fieldStarRating || undefined,\r\n        website_url: window.location.href,\r\n        source_platform: window.location.hostname\r\n      };\r\n\r\n      chrome.runtime.sendMessage(\r\n        {\r\n          type: 'GENERATE_AI_RESPONSE',\r\n          data: { reviewData }\r\n        },\r\n        (response: { success?: boolean; aiResponse?: string; error?: string; creditsRemaining?: number } | undefined) => {\r\n          if (chrome.runtime.lastError) {\r\n            setLoadingState(shadowRoot, false);\r\n            showError(shadowRoot, 'Connection error. Please try again.');\r\n            return;\r\n          }\r\n\r\n          setLoadingState(shadowRoot, false);\r\n\r\n          if (response?.success && response.aiResponse) {\r\n            lastGeneratedReply = response.aiResponse;\r\n            showResult(shadowRoot, response.aiResponse);\r\n            if (typeof response.creditsRemaining === 'number') {\r\n              updateCredits(shadowRoot, response.creditsRemaining);\r\n            }\r\n          } else {\r\n            showError(shadowRoot, response?.error || 'Failed to generate reply. Please try again.');\r\n          }\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  function setLoadingState(shadowRoot: ShadowRoot, loading: boolean): void {\r\n    isLoading = loading;\r\n    const btn = shadowRoot.getElementById('br-generate') as HTMLButtonElement | null;\r\n    const label = shadowRoot.getElementById('br-btn-label');\r\n    if (!btn || !label) return;\r\n\r\n    btn.disabled = loading;\r\n    if (loading) {\r\n      btn.innerHTML = `<span class=\"spinner\"></span><span id=\"br-btn-label\">Generating...</span>`;\r\n    } else {\r\n      btn.innerHTML = `${LIGHTNING_SVG}<span id=\"br-btn-label\">Generate Reply</span>`;\r\n    }\r\n  }\r\n\r\n  function showResult(shadowRoot: ShadowRoot, text: string): void {\r\n    const resultSection = shadowRoot.getElementById('br-result-section');\r\n    const resultArea = shadowRoot.getElementById('br-result');\r\n    if (resultSection) resultSection.style.display = 'flex';\r\n    if (resultArea) resultArea.textContent = text;\r\n    // Auto-copy as soon as the reply is ready\r\n    handleCopy(shadowRoot);\r\n  }\r\n\r\n  function showError(shadowRoot: ShadowRoot, message: string): void {\r\n    const box = shadowRoot.getElementById('br-error-box');\r\n    if (!box) return;\r\n    box.className = 'message-box error';\r\n    box.textContent = message;\r\n    box.style.display = 'block';\r\n  }\r\n\r\n  function clearError(shadowRoot: ShadowRoot): void {\r\n    const box = shadowRoot.getElementById('br-error-box');\r\n    if (box) box.style.display = 'none';\r\n  }\r\n\r\n  function handleCopy(shadowRoot: ShadowRoot): void {\r\n    const resultArea = shadowRoot.getElementById('br-result');\r\n    const text = resultArea?.textContent?.trim() || '';\r\n    if (!text) return;\r\n\r\n    const showCopied = () => {\r\n      const copyBtn = shadowRoot.getElementById('br-copy');\r\n      if (!copyBtn) return;\r\n      const original = copyBtn.innerHTML;\r\n      copyBtn.innerHTML = `\r\n        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n          <polyline points=\"20 6 9 17 4 12\"/>\r\n        </svg>\r\n        Copied!\r\n      `;\r\n      setTimeout(() => { copyBtn.innerHTML = original; }, 2000);\r\n    };\r\n\r\n    navigator.clipboard.writeText(text).then(showCopied).catch(() => {\r\n      // Fallback: create a temporary textarea, copy from it, remove it\r\n      const tmp = document.createElement('textarea');\r\n      tmp.value = text;\r\n      tmp.style.cssText = 'position:fixed;top:-9999px;left:-9999px;opacity:0;';\r\n      document.body.appendChild(tmp);\r\n      tmp.select();\r\n      document.execCommand('copy');\r\n      document.body.removeChild(tmp);\r\n      showCopied();\r\n    });\r\n  }\r\n\r\n  // ── Listen for AI_RESPONSE_RESULT pushed by service worker ─────────────────\r\n  // (Service worker calls chrome.tabs.sendMessage after generation completes)\r\n\r\n  chrome.runtime.onMessage.addListener((message, _sender, sendResponse) => {\r\n    if (message.type === 'AI_RESPONSE_RESULT') {\r\n      const host = document.getElementById(HOST_ID);\r\n      const shadowRoot = host?.shadowRoot;\r\n      if (shadowRoot) {\r\n        setLoadingState(shadowRoot, false);\r\n        const data = message.data as { success?: boolean; aiResponse?: string; error?: string; creditsRemaining?: number } | undefined;\r\n        if (data?.success && data.aiResponse) {\r\n          lastGeneratedReply = data.aiResponse;\r\n          showResult(shadowRoot, data.aiResponse);\r\n          if (typeof data.creditsRemaining === 'number') {\r\n            updateCredits(shadowRoot, data.creditsRemaining);\r\n          }\r\n        } else {\r\n          showError(shadowRoot, data?.error || 'Failed to generate reply.');\r\n        }\r\n      }\r\n      sendResponse({ success: true });\r\n    }\r\n    return false;\r\n  });\r\n\r\n  // ── Selection detection ────────────────────────────────────────────────────\r\n\r\n  document.addEventListener('mouseup', (e) => {\r\n    // Ignore clicks inside our own panel host\r\n    const host = document.getElementById(HOST_ID);\r\n    if (host && host.contains(e.target as Node)) return;\r\n\r\n    const btn = document.getElementById(BTN_ID);\r\n    if (btn && btn.contains(e.target as Node)) return;\r\n\r\n    setTimeout(() => {\r\n      const selection = window.getSelection();\r\n      const text = selection?.toString().trim() || '';\r\n\r\n      if (text.length > 10) {\r\n        savedSelectionText = text;\r\n        try {\r\n          const range = selection!.getRangeAt(0);\r\n          const rect = range.getBoundingClientRect();\r\n          showFloatingButton(rect);\r\n        } catch {\r\n          hideFloatingButton();\r\n        }\r\n      } else {\r\n        hideFloatingButton();\r\n      }\r\n    }, 10);\r\n  });\r\n\r\n  document.addEventListener('selectionchange', () => {\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.toString().trim().length <= 10) {\r\n      // Don't hide immediately — let mouseup handle it to avoid race conditions\r\n    }\r\n  });\r\n\r\n  // Hide floating button on Escape key\r\n  document.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Escape') {\r\n      hideFloatingButton();\r\n      if (panelOpen) closePanel();\r\n    }\r\n  });\r\n\r\n  // Hide floating button when clicking elsewhere (not on our elements)\r\n  document.addEventListener('click', (e) => {\r\n    const host = document.getElementById(HOST_ID);\r\n    const btn = document.getElementById(BTN_ID);\r\n    const target = e.target as Node;\r\n    if (host?.contains(target) || btn?.contains(target)) return;\r\n\r\n    // If selection is gone, hide button\r\n    const selection = window.getSelection();\r\n    if (!selection || selection.toString().trim().length <= 10) {\r\n      hideFloatingButton();\r\n    }\r\n  });\r\n\r\n})();\r\n"],"names":["HOST_ID","BTN_ID","LIGHTNING_SVG","ICON_URL","chrome","runtime","getURL","LOGO_URL","savedSelectionText","isLoading","panelOpen","fieldReviewerName","fieldStarRating","fieldReviewText","lastGeneratedReply","hideFloatingButton","btn","document","getElementById","style","display","highlightStars","shadowRoot","upTo","querySelectorAll","forEach","star","i","classList","add","remove","closePanel","host","panel","setTimeout","updateCredits","remaining","creditsEl","textContent","storage","local","set","credits_remaining","setLoadingState","loading","label","disabled","innerHTML","showResult","text","resultSection","resultArea","handleCopy","showError","message","box","className","trim","showCopied","copyBtn","original","navigator","clipboard","writeText","then","catch","tmp","createElement","value","cssText","body","appendChild","select","execCommand","removeChild","onMessage","addListener","_sender","sendResponse","type","data","success","aiResponse","creditsRemaining","error","addEventListener","e","contains","target","selection","window","getSelection","toString","length","rect","existing","id","title","transform","boxShadow","preventDefault","textToUse","prefillText","attachShadow","mode","getOrCreatePanelHost","starsContainer","parseInt","getAttribute","setStarRating","nameInput","reviewTextarea","reviewerName","undefined","reviewText","clearError","sendMessage","authResponse","lastError","isAuthenticated","reviewData","review_text","reviewer_name","review_rating","website_url","location","href","source_platform","hostname","response","handleGenerate","attachPanelListeners","buildPanelHTML","get","result","val","loadCredits","requestAnimationFrame","openPanel","getOrCreateFloatingButton","top","left","right","bottom","Math","max","min","innerWidth","showFloatingButton","getRangeAt","getBoundingClientRect","key"],"sourceRoot":""}